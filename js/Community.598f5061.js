(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Community"],{"086e":function(t,n,e){t.exports=e.p+"img/usdt.327b185e.svg"},2532:function(t,n,e){"use strict";var o=e("23e7"),s=e("5a34"),i=e("1d80"),r=e("ab13");o({target:"String",proto:!0,forced:!r("includes")},{includes:function(t){return!!~String(i(this)).indexOf(s(t),arguments.length>1?arguments[1]:void 0)}})},"44e7":function(t,n,e){var o=e("861d"),s=e("c6b6"),i=e("b622"),r=i("match");t.exports=function(t){var n;return o(t)&&(void 0!==(n=t[r])?!!n:"RegExp"==s(t))}},5358:function(t,n,e){},"53de":function(t,n,e){"use strict";e("5358")},"5a34":function(t,n,e){var o=e("44e7");t.exports=function(t){if(o(t))throw TypeError("The method doesn't accept regular expressions");return t}},"7d1b":function(t,n,e){t.exports=e.p+"img/back.1028a30c.svg"},"8b76":function(t,n,e){t.exports=e.p+"img/ailogo.350e812b.svg"},"9a52":function(t,n,e){t.exports=e.p+"img/DownArrow.3b10808c.svg"},ab13:function(t,n,e){var o=e("b622"),s=o("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[s]=!1,"/./"[t](n)}catch(o){}}return!1}},caad:function(t,n,e){"use strict";var o=e("23e7"),s=e("4d64").includes,i=e("44d2"),r=e("ae40"),a=r("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:!a},{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")},f48e:function(t,n,e){t.exports=e.p+"img/PinToken.f4bb9f8e.svg"},f7d6:function(t,n,e){"use strict";e.r(n);var o=function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"HJZCommunity"},[o("div",{staticClass:"title"},[o("img",{attrs:{src:e("7d1b")},on:{click:function(n){return t.$router.back()}}}),o("span",[t._v("DAO")])]),o("div",{staticClass:"content"},[o("div",{staticClass:"container"},[o("div",{staticClass:"DAOgovernance"},[o("span",[t._v(t._s(t.$t("HJZCommunity.text30")))])]),o("div",{staticClass:"container1"},[o("div",{staticClass:"HJZCommunitySwap"},[o("div",{on:{click:t.showToken1}},[o("div",{staticClass:"DownArrow"},[o("span",[t._v(t._s(t.xtoken))]),o("img",{attrs:{src:e("9a52")}})]),o("span",{staticClass:"fonts13"},[t._v(t._s(t.selectamount))]),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showToken,expression:"showToken"}],staticClass:"languagechoose"},[o("div",{staticClass:"active",on:{click:function(n){return t.ChooseToken1("USDT")}}},[t._v("USDT")]),o("div",{on:{click:function(n){return t.ChooseToken1("AI")}}},[t._v("AI")])])]),o("div",[o("img",{attrs:{src:t.tokenLogo}}),o("img",{attrs:{src:e("f48e")}})]),o("div",[o("span",[t._v("PIN")]),o("span",{staticClass:"fonts13"},[t._v(t._s(t.pin.toFixed(2)))])])]),o("div",{staticClass:"HJZCommunityInput"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.usdtAmount,expression:"usdtAmount"}],attrs:{type:"text",placeholder:t.$t("HJZCommunity.text4",{token:t.xtoken})},domProps:{value:t.usdtAmount},on:{input:[function(n){n.target.composing||(t.usdtAmount=n.target.value)},t.inputAmount]}}),o("span",[t._v("+")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.pinAmount,expression:"pinAmount"}],attrs:{type:"text",placeholder:"0.0000",disabled:""},domProps:{value:t.pinAmount},on:{input:function(n){n.target.composing||(t.pinAmount=n.target.value)}}})]),o("div",{staticClass:"get-power"},[o("span",[t._v(t._s(t.$t("HJZCommunity.text31"))+" "),o("span",[t._v(t._s(t.aiPower))])]),o("span",[t._v(t._s(t.$t("HJZCommunity.text32"))+" "),o("span",[t._v(t._s(t.pinPower))])])]),o("van-button",{directives:[{name:"ButClickLimit",rawName:"v-ButClickLimit"}],attrs:{disabled:t.btnDisabled,loading:"none"!=t.state,"loading-text":t.btnText},on:{click:t.sendTrade}},[t._v(t._s(t.btnText))])],1)])])])},s=[],i=(e("caad"),e("a9e3"),e("b680"),e("d3b7"),e("25f0"),e("2532"),e("96cf"),e("1da1")),r={computed:{btnText:function(){if(Number(this.usdtAmount)<=0)return this.$t("HJZCommunity.text13");if("approving"===this.state)return this.usdtAllowance<Number(this.usdtAmount)?this.$t("HJZCommunity.text23"):this.$t("HJZCommunity.text24",{token:"PIN"});if("trading"===this.state)return this.$t("HJZCommunity.text25");if("USDT"===this.xtoken){if(this.usdtAllowance<Number(this.usdtAmount)||0===this.usdtAllowance)return this.$t("HJZCommunity.text9",{token:"USDT"});if(this.pinAllowance<Number(this.pinAmount)||0===this.pinAllowance)return this.$t("HJZCommunity.text9",{token:"PIN"})}else if("AI"===this.xtoken){if(this.AiAllowance<Number(this.usdtAmount)||0===this.AiAllowance)return this.$t("HJZCommunity.text9",{token:"AI"});if(this.pinAllowance<Number(this.pinAmount)||0===this.pinAllowance)return this.$t("HJZCommunity.text9",{token:"PIN"})}return this.$t("HJZCommunity.text13")},btnDisabled:function(){return Number(this.usdtAmount)<=0||"none"!==this.state}},data:function(){return{usdt:0,pin:0,Ai:0,usdtAmount:"",pinAmount:"",usdtAllowance:0,pinAllowance:0,AiAllowance:0,state:"none",ChooseToken:"",aiPower:0,pinPower:0,decimals:0,myQuota:0,selectamount:0,show:!1,toWho:this.$t("HJZCommunity.text20"),disabled:!1,Myself:this.$t("HJZCommunity.text20"),Other:this.$t("HJZCommunity.text21"),isStart:!1,showToken:!1,xtoken:"AI",tokenLogo:e("8b76"),USDTLogo:e("086e"),AILogo:e("8b76"),inputing:!1}},created:function(){this.$contracts&&this.init()},methods:{init:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.$contracts.Mine.methods.usdPerPowerE12().call({from:t.$address},(function(t,n){t||console.log("1U =",n.fromWei(12))})),e=new t.$web3.BatchRequest,e.add(t.$contracts.Community.methods.isStart().call.request({from:t.$address})),e.add(t.$contracts.USDTMock.methods.balanceOf(t.$address).call.request({from:t.$address})),e.add(t.$contracts.PINMock.methods.balanceOf(t.$address).call.request({from:t.$address})),e.add(t.$contracts.USDTMock.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),e.add(t.$contracts.PINMock.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),e.add(t.$contracts.Community.methods.myQuota().call.request({from:t.$address})),e.add(t.$contracts.AIToken.methods.balanceOf(t.$address).call.request({from:t.$address})),e.add(t.$contracts.AIToken.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),e.requestManager.sendBatch(e.requests,(function(n,e){n||(t.isStart=("string"===typeof e[0]?e[0]:e[0].result).decode(["bool"]),t.usdt=e[1].result.decode(["uint256"]).fromWei(),t.selectamount=e[6].result.decode(["uint256"]).fromWei().toFixed(2),t.pin=e[2].result.decode(["uint256"]).fromWei(),t.usdtAllowance=e[3].result.decode(["uint256"]).fromWei(),t.pinAllowance=e[4].result.decode(["uint256"]).fromWei(),t.myQuota=e[5].result.fromWei().toBN().div(2),t.Ai=e[6].result.decode(["uint256"]).fromWei(),t.AiAllowance=e[7].result.decode(["uint256"]).fromWei())}));case 11:case"end":return n.stop()}}),n)})))()},inputAmount:function(){var t=this;if(Number(this.usdtAmount)<=0)return this.pinAmount="",this.aiPower=0,this.pinPower=0,this.inputing=!1,!1;if(this.inputing)return!1;if(this.inputing=!0,"USDT"===this.xtoken)var n=setTimeout((function(){t.$contracts.Community.methods.convertInfo(t.usdtAmount.toWei()).call({from:t.$address},(function(e,o){e?(t.statu="",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0):(t.pinAmount=o.pinAmount.fromWei(),t.aiPower=o.power_dao,t.pinPower=o.power_pin),t.inputing=!1,clearTimeout(n)}))}),1e3);else var e=setTimeout((function(){t.$contracts.Community.methods.convertInfoAI(t.usdtAmount.toWei()).call({from:t.$address},function(){var n=Object(i["a"])(regeneratorRuntime.mark((function n(o,s){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o?(console.log(o),t.statu="",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0):(t.pinAmount=s.pinAmount.fromWei(),t.aiPower=s.power_dao,t.pinPower=s.power_pin),t.inputing=!1,clearTimeout(e);case 3:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}())}),1e3);console.log(this.AiAllowance+"AI授权"),console.log(this.pinAllowance+"PIN授权")},approve:function(){var t=this;if("USDT"===this.xtoken){if(this.usdtAmount.toBN().gt(this.usdt))return vant.Toast.fail(this.$t("HJZCommunity.text15",{token:"USDT"}));if(this.usdtAmount.toBN().lt(1))return vant.Toast.fail(this.$t("HJZCommunity.text26",{token:"USDT"}))}if("USDT"===this.xtoken)var n=this.usdtAllowance<Number(this.usdtAmount)?this.$contracts.USDTMock:this.$contracts.PINMock,e=this.usdtAllowance<Number(this.usdtAmount)?this.usdtAmount.toBN().times(10).toString().toWei():this.pinAmount.toBN().times(10).toString().toWei();else n=this.AiAllowance<Number(this.usdtAmount)?this.$contracts.AIToken:this.$contracts.PINMock,e=this.AiAllowance<Number(this.usdtAmount)?this.usdtAmount.toBN().times(10).toString().toWei():this.pinAmount.toBN().times(10).toString().toWei();n.methods.approve(this.$contracts.Community._address,e).send({from:this.$address}).on("transactionHash",(function(n){t.state="approving"})).on("receipt",function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(o){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.methods.allowance(t.$address,t.$contracts.Community._address).call({from:t.$address});case 2:s=e.sent,"USDT"===t.xtoken?t.usdtAllowance<Number(t.usdtAmount)?t.usdtAllowance=s.fromWei():t.pinAllowance=s.fromWei():t.AiAllowance<Number(t.usdtAmount)?t.AiAllowance=s.fromWei():t.pinAllowance=s.fromWei(),t.state="none";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).on("error",(function(n){vant.Toast.fail(t.$t("HJZCommunity.text27")),t.state="none"}))},sendTrade:function(){return this.isStart?this.btnText.includes("授权")?this.approve():this.convert():vant.Toast.fail("合约暂未生效！")},convert:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var e,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("USDT"!==t.xtoken){n.next=9;break}if(!t.usdtAmount.toBN().gt(t.usdt)){n.next=5;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"USDT"})));case 5:if(!t.usdtAmount.toBN().lt(1)){n.next=7;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text26",{token:"USDT"})));case 7:n.next=15;break;case 9:if(!t.usdtAmount.toBN().gt(t.Ai)){n.next=13;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"AI"})));case 13:if(!t.usdtAmount.toBN().lt(1)){n.next=15;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text26",{token:"AI"})));case 15:if(!t.pinAmount.toBN().gt(t.pin)){n.next=19;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"PIN"})));case 19:if(!t.usdtAmount.toBN().gt(t.myQuota)){n.next=21;break}return n.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text17")));case 21:"USDT"===t.xtoken?(console.log("进入USDT"),e=t.$contracts.Community.methods.convert(t.usdtAmount.toWei()),e.call({from:t.$address},(function(n,o){n?console.log(n):e.send({from:t.$address}).on("transactionHash",(function(n){t.state="trading"})).on("receipt",(function(n){vant.Toast.success(t.$t("HJZCommunity.text18")),t.state="none",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0,t.init()})).on("error",(function(n){vant.Toast.fail(t.$t("HJZCommunity.text29")),t.state="none"}))}))):(console.log("进入AI"),console.log(t.$contracts),o=t.$contracts.Community.methods.convertAI(t.usdtAmount.toWei()),o.call({from:t.$address},(function(n,e){n?console.log(n):o.send({from:t.$address}).on("transactionHash",(function(n){t.state="trading"})).on("receipt",(function(n){vant.Toast.success(t.$t("HJZCommunity.text18")),t.state="none",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0,t.init(),t.reload()})).on("error",(function(n){vant.Toast.fail(t.$t("HJZCommunity.text29")),t.state="none"}))})));case 22:case"end":return n.stop()}}),n)})))()},ChooseToken1:function(t){this.xtoken=t,this.selectamount="USDT"===t?this.usdt.toFixed(2):this.Ai.toFixed(2),this.tokenLogo="USDT"===t?this.USDTLogo:this.AILogo},showToken1:function(){this.showToken=!this.showToken}}},a=r,u=a,c=(e("53de"),e("2877")),m=Object(c["a"])(u,o,s,!1,null,"a46e112c",null);n["default"]=m.exports}}]);