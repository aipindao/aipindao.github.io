(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Community"],{"086e":function(t,e,n){t.exports=n.p+"img/usdt.327b185e.svg"},2532:function(t,e,n){"use strict";var o=n("23e7"),s=n("5a34"),i=n("1d80"),r=n("ab13");o({target:"String",proto:!0,forced:!r("includes")},{includes:function(t){return!!~String(i(this)).indexOf(s(t),arguments.length>1?arguments[1]:void 0)}})},"44e7":function(t,e,n){var o=n("861d"),s=n("c6b6"),i=n("b622"),r=i("match");t.exports=function(t){var e;return o(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==s(t))}},"5a34":function(t,e,n){var o=n("44e7");t.exports=function(t){if(o(t))throw TypeError("The method doesn't accept regular expressions");return t}},"7ae8":function(t,e,n){},"7d1b":function(t,e,n){t.exports=n.p+"img/back.1028a30c.svg"},"8b76":function(t,e,n){t.exports=n.p+"img/ailogo.350e812b.svg"},"9a52":function(t,e,n){t.exports=n.p+"img/DownArrow.3b10808c.svg"},ab13:function(t,e,n){var o=n("b622"),s=o("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[s]=!1,"/./"[t](e)}catch(o){}}return!1}},b4d1:function(t,e,n){"use strict";n("7ae8")},caad:function(t,e,n){"use strict";var o=n("23e7"),s=n("4d64").includes,i=n("44d2"),r=n("ae40"),a=r("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:!a},{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")},f48e:function(t,e,n){t.exports=n.p+"img/PinToken.f4bb9f8e.svg"},f7d6:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"HJZCommunity"},[o("div",{staticClass:"title"},[o("img",{attrs:{src:n("7d1b")},on:{click:function(e){return t.$router.back()}}}),o("span",[t._v("DAO")])]),o("div",{staticClass:"content"},[o("div",{staticClass:"container"},[t._m(0),o("div",{staticClass:"container1"},[o("div",{staticClass:"HJZCommunitySwap"},[o("div",{on:{click:t.showToken1}},[o("div",{staticClass:"DownArrow"},[o("span",[t._v(t._s(t.xtoken))]),o("img",{attrs:{src:n("9a52")}})]),o("span",{staticClass:"fonts13"},[t._v(t._s(t.selectamount))]),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showToken,expression:"showToken"}],staticClass:"languagechoose"},[o("div",{staticClass:"active",on:{click:function(e){return t.ChooseToken1("USDT")}}},[t._v("USDT")]),o("div",{on:{click:function(e){return t.ChooseToken1("AI")}}},[t._v("AI")])])]),o("div",[o("img",{attrs:{src:t.tokenLogo}}),o("img",{attrs:{src:n("f48e")}})]),o("div",[o("span",[t._v("PIN")]),o("span",{staticClass:"fonts13"},[t._v(t._s(t.pin.toFixed(2)))])])]),o("div",{staticClass:"HJZCommunityInput"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.usdtAmount,expression:"usdtAmount"}],attrs:{type:"text",placeholder:t.$t("HJZCommunity.text4",{token:t.xtoken})},domProps:{value:t.usdtAmount},on:{input:[function(e){e.target.composing||(t.usdtAmount=e.target.value)},t.inputAmount]}}),o("span",[t._v("+")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.pinAmount,expression:"pinAmount"}],attrs:{type:"text",placeholder:"0.0000",disabled:""},domProps:{value:t.pinAmount},on:{input:function(e){e.target.composing||(t.pinAmount=e.target.value)}}})]),o("div",{staticClass:"get-power"},[o("span",[t._v("获得AI算力 "),o("span",[t._v(t._s(t.aiPower))])]),o("span",[t._v("获得PIN算力 "),o("span",[t._v(t._s(t.pinPower))])])]),o("van-button",{directives:[{name:"ButClickLimit",rawName:"v-ButClickLimit"}],attrs:{disabled:t.btnDisabled,loading:"none"!=t.state,"loading-text":t.btnText},on:{click:t.sendTrade}},[t._v(t._s(t.btnText))])],1)])])])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"DAOgovernance"},[n("span",[t._v("参与DAO治理")])])}],i=(n("caad"),n("a9e3"),n("b680"),n("d3b7"),n("25f0"),n("2532"),n("96cf"),n("1da1")),r={computed:{btnText:function(){if(Number(this.usdtAmount)<=0)return this.$t("HJZCommunity.text13");if("approving"===this.state)return this.usdtAllowance<Number(this.usdtAmount)?this.$t("HJZCommunity.text23"):this.$t("HJZCommunity.text24",{token:"PIN"});if("trading"===this.state)return this.$t("HJZCommunity.text25");if("USDT"===this.xtoken){if(this.usdtAllowance<Number(this.usdtAmount)||0===this.usdtAllowance)return this.$t("HJZCommunity.text9",{token:"USDT"})}else if("AI"===this.xtoken){if(this.AiAllowance<Number(this.usdtAmount)||0===this.AiAllowance)return this.$t("HJZCommunity.text9",{token:"AI"})}else if(this.pinAllowance<Number(this.pinAmount)||0===this.pinAllowance)return this.$t("HJZCommunity.text9",{token:"PIN"});return this.$t("HJZCommunity.text13")},btnDisabled:function(){return Number(this.usdtAmount)<=0||"none"!==this.state}},data:function(){return{usdt:0,pin:0,Ai:0,usdtAmount:"",pinAmount:"",usdtAllowance:0,pinAllowance:0,AiAllowance:0,state:"none",ChooseToken:"",aiPower:0,pinPower:0,decimals:0,myQuota:0,selectamount:0,show:!1,toWho:this.$t("HJZCommunity.text20"),disabled:!1,Myself:this.$t("HJZCommunity.text20"),Other:this.$t("HJZCommunity.text21"),isStart:!1,showToken:!1,xtoken:"AI",tokenLogo:n("8b76"),USDTLogo:n("086e"),AILogo:n("8b76"),inputing:!1}},created:function(){this.$contracts&&this.init()},methods:{init:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$contracts.Mine.methods.usdPerPowerE12().call({from:t.$address},(function(t,e){t||console.log("1U =",e.fromWei(12))})),n=new t.$web3.BatchRequest,console.log(t.$contracts),n.add(t.$contracts.Community.methods.isStart().call.request({from:t.$address})),n.add(t.$contracts.USDTMock.methods.balanceOf(t.$address).call.request({from:t.$address})),n.add(t.$contracts.PINMock.methods.balanceOf(t.$address).call.request({from:t.$address})),n.add(t.$contracts.USDTMock.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),n.add(t.$contracts.PINMock.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),n.add(t.$contracts.Community.methods.myQuota().call.request({from:t.$address})),n.add(t.$contracts.AIToken.methods.balanceOf(t.$address).call.request({from:t.$address})),n.add(t.$contracts.AIToken.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),n.requestManager.sendBatch(n.requests,(function(e,n){e||(t.isStart=("string"===typeof n[0]?n[0]:n[0].result).decode(["bool"]),t.usdt=n[1].result.decode(["uint256"]).fromWei(),t.selectamount=n[6].result.decode(["uint256"]).fromWei().toFixed(2),t.pin=n[2].result.decode(["uint256"]).fromWei(),t.usdtAllowance=n[3].result.decode(["uint256"]).fromWei(),t.pinAllowance=n[4].result.decode(["uint256"]).fromWei(),t.myQuota=n[5].result.fromWei().toBN().div(2),t.Ai=n[6].result.decode(["uint256"]).fromWei(),t.AiAllowance=n[7].result.decode(["uint256"]).fromWei())}));case 12:case"end":return e.stop()}}),e)})))()},inputAmount:function(){var t=this;if(Number(this.usdtAmount)<=0)return this.pinAmount="",this.aiPower=0,this.pinPower=0,this.inputing=!1,!1;if(this.inputing)return!1;if(this.inputing=!0,"USDT"===this.xtoken)var e=setTimeout((function(){t.$contracts.Community.methods.convertInfo(t.usdtAmount.toWei()).call({from:t.$address},(function(n,o){n?(console.log(n),t.statu="",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0):(t.pinAmount=o.pinAmount.fromWei(),t.aiPower=o.power_dao,t.pinPower=o.power_pin),t.inputing=!1,clearTimeout(e)}))}),1e3);else var n=setTimeout((function(){t.$contracts.Community.methods.convertInfoAI(t.usdtAmount.toWei()).call({from:t.$address},(function(e,o){e?(console.log(e),t.statu="",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0):(t.pinAmount=o.pinAmount.fromWei(),t.aiPower=o.power_dao,t.pinPower=o.power_pin),t.inputing=!1,clearTimeout(n)}))}),1e3)},approve:function(){var t=this;if("USDT"===this.xtoken)var e=this.usdtAllowance<Number(this.usdtAmount)?this.$contracts.USDTMock:this.$contracts.PINMock;else e=this.AiAllowance<Number(this.usdtAmount)?this.$contracts.AIToken:this.$contracts.PINMock;var n=this.usdtAllowance<Number(this.usdtAmount)?this.usdtAmount.toBN().times(10).toString().toWei():this.pinAmount.toBN().times(10).toString().toWei();e.methods.approve(this.$contracts.Community._address,n).send({from:this.$address}).on("transactionHash",(function(e){t.state="approving"})).on("receipt",function(){var n=Object(i["a"])(regeneratorRuntime.mark((function n(o){var s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.methods.allowance(t.$address,t.$contracts.Community._address).call({from:t.$address});case 2:s=n.sent,"USDT"===t.xtoken?t.usdtAllowance<Number(t.usdtAmount)?t.usdtAllowance=s.fromWei():t.pinAllowance=s.fromWei():t.AiAllowance<Number(t.usdtAmount)?t.AiAllowance=s.fromWei():t.pinAllowance=s.fromWei(),t.state="none";case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()).on("error",(function(e){vant.Toast.fail(t.$t("HJZCommunity.text27")),t.state="none"}))},sendTrade:function(){return this.isStart?this.btnText.includes("授权")?this.approve():this.convert():vant.Toast.fail("合约暂未生效！")},convert:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("USDT"!==t.xtoken){e.next=9;break}if(!t.usdtAmount.toBN().gt(t.usdt)){e.next=5;break}return e.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"USDT"})));case 5:if(!t.usdtAmount.toBN().lt(1)){e.next=7;break}return e.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text26",{token:"USDT"})));case 7:e.next=15;break;case 9:if(!t.usdtAmount.toBN().gt(t.Ai)){e.next=13;break}return e.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"AI"})));case 13:if(!t.usdtAmount.toBN().lt(1)){e.next=15;break}return e.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text26",{token:"AI"})));case 15:if(!t.pinAmount.toBN().gt(t.pin)){e.next=19;break}return e.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text15",{token:"PIN"})));case 19:if(!t.usdtAmount.toBN().gt(t.myQuota)){e.next=21;break}return e.abrupt("return",vant.Toast.fail(t.$t("HJZCommunity.text17")));case 21:n=t.$contracts.Community.methods.convert(t.usdtAmount.toWei()),o=t.$contracts.Community.methods.convertAI(t.usdtAmount.toWei()),"USDT"===t.xtoken?n.call({from:t.$address},(function(e,o){e?console.log(e):n.send({from:t.$address}).on("transactionHash",(function(e){t.state="trading"})).on("receipt",(function(e){vant.Toast.success(t.$t("HJZCommunity.text18")),t.state="none",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0,t.init(),t.$getBalance()})).on("error",(function(e){vant.Toast.fail(t.$t("HJZCommunity.text29")),t.state="none"}))})):o.call({from:t.$address},(function(e,o){e?console.log(e):n.send({from:t.$address}).on("transactionHash",(function(e){t.state="trading"})).on("receipt",(function(e){vant.Toast.success(t.$t("HJZCommunity.text18")),t.state="none",t.usdtAmount="",t.pinAmount="",t.aiPower=0,t.pinPower=0,t.init(),t.$getBalance()})).on("error",(function(e){vant.Toast.fail(t.$t("HJZCommunity.text29")),t.state="none"}))}));case 24:case"end":return e.stop()}}),e)})))()},ChooseToken1:function(t){this.xtoken=t,this.selectamount="USDT"===t?this.usdt.toFixed(2):this.Ai.toFixed(2),this.tokenLogo="USDT"===t?this.USDTLogo:this.AILogo},showToken1:function(){this.showToken=!this.showToken}}},a=r,u=a,c=(n("b4d1"),n("2877")),d=Object(c["a"])(u,o,s,!1,null,"44964e47",null);e["default"]=d.exports}}]);